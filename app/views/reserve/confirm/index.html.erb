<% content_for :title, "ご予約内容確認 - 富士伊豆農業協同組合 予約システム" %>

<div class="max-w-4xl mx-auto">
  <!-- ヘッダーセクション -->
  <div class="flex flex-col md:flex-row items-center justify-center gap-6 mb-8">
    <div class="hidden md:block flex-shrink-0">
      <%= image_tag 'illustrations/checklist.svg', alt: '内容確認', class: 'w-32 h-32', loading: 'lazy' %>
    </div>
    <div class="text-center md:text-left flex-1">
      <h1 class="heading-2 font-bold text-blue-600 pb-2">
        ご予約内容の確認
      </h1>
      <p class="body-lg text-gray-600 mt-2">
        内容をご確認の上、予約を確定してください
      </p>
    </div>
  </div>

  <!-- 進捗表示 -->
  <div class="mb-8">
    <div class="flex items-center justify-center space-x-4 mb-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-lg">✓</div>
        <span class="ml-2 text-lg text-green-600">エリア選択</span>
      </div>
      <div class="w-8 h-1 bg-green-600"></div>
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-lg">✓</div>
        <span class="ml-2 text-lg text-green-600">支店選択</span>
      </div>
      <div class="w-8 h-1 bg-green-600"></div>
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-lg">✓</div>
        <span class="ml-2 text-lg text-green-600">日時選択</span>
      </div>
      <div class="w-8 h-1 bg-green-600"></div>
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-lg">✓</div>
        <span class="ml-2 text-lg text-green-600">お客様情報</span>
      </div>
      <div class="w-8 h-1 bg-green-600"></div>
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-lg">5</div>
        <span class="ml-2 text-lg font-semibold text-green-600">内容確認</span>
      </div>
    </div>
  </div>

  <!-- エラー表示 -->
  <% if @appointment.errors.any? %>
    <%= render 'shared/form_error', model: @appointment %>
  <% end %>

  <!-- 確認メインコンテンツ -->
  <%= render 'shared/card',
      title: 'ご予約内容をご確認ください',
      subtitle: '内容に誤りがないかご確認の上、予約を確定してください',
      padding: 'lg',
      shadow: 'lg' do %>
    
    <div class="space-y-8">
      <!-- 予約情報 -->
      <div>
        <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-200">
          <i class="fas fa-calendar-check text-green-600 mr-2"></i>
          予約情報
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">支店</dt>
              <dd class="text-lg text-gray-800 font-medium"><%= @branch.name %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">住所</dt>
              <dd class="text-lg text-gray-800"><%= @branch.address %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">電話番号</dt>
              <dd class="text-lg text-gray-800">
                <%= @branch.phone.gsub(/(\d{4})(\d{2})(\d{4})/, '\1-\2-\3') if @branch.phone.length == 10 %>
                <%= @branch.phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') if @branch.phone.length == 11 %>
              </dd>
            </div>
          </div>
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">予約日</dt>
              <dd class="text-xl text-gray-800 font-bold">
                <%= @slot.starts_at.strftime('%Y年%-m月%-d日') %>
                <span class="text-lg">（<%= %w[日 月 火 水 木 金 土][@slot.starts_at.wday] %>曜日）</span>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">予約時間</dt>
              <dd class="text-xl text-gray-800 font-bold">
                <%= @slot.starts_at.strftime('%H:%M') %> - <%= @slot.ends_at.strftime('%H:%M') %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">相談種別</dt>
              <dd class="text-lg text-gray-800 font-medium"><%= @appointment_type.name %></dd>
            </div>
          </div>
        </div>
      </div>

      <!-- お客様情報 -->
      <div>
        <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-200">
          <i class="fas fa-user text-green-600 mr-2"></i>
          お客様情報
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">お名前</dt>
              <dd class="text-lg text-gray-800 font-medium"><%= @customer_info[:name] %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">フリガナ</dt>
              <dd class="text-lg text-gray-800"><%= @customer_info[:furigana] %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">電話番号</dt>
              <dd class="text-lg text-gray-800">
                <% phone = @customer_info[:phone] %>
                <%= phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') if phone.length == 11 %>
                <%= phone.gsub(/(\d{4})(\d{2})(\d{4})/, '\1-\2-\3') if phone.length == 10 %>
              </dd>
            </div>
          </div>
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">メールアドレス</dt>
              <dd class="text-lg text-gray-800">
                <%= @customer_info[:email].present? ? @customer_info[:email] : '（未入力）' %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">ご来店人数</dt>
              <dd class="text-lg text-gray-800">
                <%= @customer_info[:party_size] || 1 %>名様
              </dd>
            </div>
          </div>
        </div>
      </div>

      <!-- 相談内容・備考 -->
      <% if @customer_info[:purpose].present? || @customer_info[:notes].present? %>
        <div>
          <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-200">
            <i class="fas fa-comment-alt text-green-600 mr-2"></i>
            ご相談内容・ご要望
          </h3>
          <div class="space-y-4">
            <% if @customer_info[:purpose].present? %>
              <div>
                <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">ご相談内容</dt>
                <dd class="text-lg text-gray-800 bg-gray-50 border border-gray-200 rounded-lg p-4 whitespace-pre-line">
                  <%= @customer_info[:purpose] %>
                </dd>
              </div>
            <% end %>
            <% if @customer_info[:notes].present? %>
              <div>
                <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">その他・ご要望</dt>
                <dd class="text-lg text-gray-800 bg-gray-50 border border-gray-200 rounded-lg p-4 whitespace-pre-line">
                  <%= @customer_info[:notes] %>
                </dd>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 確定ボタン -->
    <div class="mt-8 pt-6 border-t border-gray-200">
      <%= form_with url: reserve_confirm_path, local: true, html: { class: "space-y-4" } do |f| %>
        <!-- 最終確認チェックボックス -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
          <div class="flex items-start">
            <%= check_box_tag :final_confirmation, '1', false,
                class: "w-5 h-5 text-green-600 border border-gray-300 rounded focus:ring-green-500 focus:ring-2 mt-1",
                required: true %>
            <%= label_tag :final_confirmation, class: "ml-3 text-lg text-gray-700 cursor-pointer" do %>
              上記の内容で予約を確定します
              <span class="text-red-600 ml-1">*</span>
              <div class="text-sm text-gray-600 mt-1">
                ※ 予約確定後のキャンセル・変更は、お電話にてお願いいたします
              </div>
            <% end %>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4">
          <%= render 'shared/btn',
              text: '予約を確定する',
              variant: 'primary',
              size: 'xl',
              type: 'submit',
              block: true,
              icon: 'fas fa-check' %>
        </div>
      <% end %>
    </div>
  <% end %>

  <!-- ナビゲーションボタン -->
  <div class="mt-8 flex justify-between">
    <%= render 'shared/btn',
        text: '入力内容を修正する',
        variant: 'outline-secondary',
        size: 'lg',
        url: reserve_steps_customer_path(slot_id: @slot.id),
        icon: 'fas fa-edit' %>
    
    <%= render 'shared/btn',
        text: 'ホームに戻る',
        variant: 'secondary',
        size: 'lg',
        url: root_path %>
  </div>
</div>

<!-- Font Awesome CDN -->
<% content_for :head do %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<% end %>