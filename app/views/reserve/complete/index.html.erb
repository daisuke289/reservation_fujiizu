<% content_for :title, "予約完了 - 富士伊豆農業協同組合 予約システム" %>

<div class="max-w-4xl mx-auto">
  <!-- 完了メッセージ -->
  <div class="text-center mb-8">
    <div class="inline-flex items-center justify-center w-24 h-24 bg-green-100 rounded-full mb-6">
      <i class="fas fa-check-circle text-4xl text-green-600"></i>
    </div>
    <h1 class="text-3xl md:text-4xl font-bold text-green-800 mb-4">
      ご予約が完了しました
    </h1>
    <p class="text-xl text-gray-700">
      ご予約ありがとうございます。<br>
      以下の内容で承りました。
    </p>
  </div>

  <!-- 受付番号 -->
  <div class="mb-8">
    <%= render 'shared/card',
        title: '受付番号',
        padding: 'lg',
        shadow: 'lg',
        bg_color: 'bg-green-50' do %>
      <div class="text-center">
        <div class="text-4xl md:text-5xl font-bold text-green-700 mb-2 tracking-wider">
          <%= @reception_number %>
        </div>
        <p class="text-lg text-gray-700">
          この番号は、お問い合わせの際に必要となります。<br>
          お控えください。
        </p>
      </div>
    <% end %>
  </div>

  <!-- 予約詳細 -->
  <%= render 'shared/card',
      title: 'ご予約内容',
      padding: 'lg',
      shadow: 'lg' do %>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- 日時・場所情報 -->
      <div class="space-y-6">
        <div>
          <h3 class="text-lg font-bold text-gray-800 mb-3 pb-2 border-b border-gray-200">
            <i class="fas fa-calendar-check text-green-600 mr-2"></i>
            日時・場所
          </h3>
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">予約日</dt>
              <dd class="text-xl text-gray-800 font-bold">
                <%= @appointment.slot.starts_at.strftime('%Y年%-m月%-d日') %>
                <span class="text-lg">（<%= %w[日 月 火 水 木 金 土][@appointment.slot.starts_at.wday] %>曜日）</span>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">時間</dt>
              <dd class="text-xl text-gray-800 font-bold">
                <%= @appointment.slot.starts_at.strftime('%H:%M') %> - <%= @appointment.slot.ends_at.strftime('%H:%M') %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">支店</dt>
              <dd class="text-lg text-gray-800 font-medium"><%= @appointment.branch.name %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">住所</dt>
              <dd class="text-lg text-gray-800"><%= @appointment.branch.address %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">電話番号</dt>
              <dd class="text-lg text-gray-800">
                <% phone = @appointment.branch.phone %>
                <%= phone.gsub(/(\d{4})(\d{2})(\d{4})/, '\1-\2-\3') if phone.length == 10 %>
                <%= phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') if phone.length == 11 %>
              </dd>
            </div>
          </div>
        </div>
      </div>

      <!-- お客様情報 -->
      <div class="space-y-6">
        <div>
          <h3 class="text-lg font-bold text-gray-800 mb-3 pb-2 border-b border-gray-200">
            <i class="fas fa-user text-green-600 mr-2"></i>
            お客様情報
          </h3>
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">お名前</dt>
              <dd class="text-lg text-gray-800 font-medium"><%= @appointment.name %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">相談種別</dt>
              <dd class="text-lg text-gray-800"><%= @appointment.appointment_type.name %></dd>
            </div>
            <div>
              <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">ご来店人数</dt>
              <dd class="text-lg text-gray-800"><%= @appointment.party_size %>名様</dd>
            </div>
            <% if @appointment.email.present? %>
              <div>
                <dt class="text-sm font-semibold text-gray-600 uppercase tracking-wide">メールアドレス</dt>
                <dd class="text-lg text-gray-800"><%= @appointment.email %></dd>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- 地図 -->
  <div class="mt-8">
    <%= render 'shared/card',
        title: 'アクセス',
        subtitle: '支店の場所をご確認ください',
        padding: 'lg',
        shadow: 'lg' do %>
      
      <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden">
        <iframe 
          src="https://www.google.com/maps/embed/v1/place?key=YOUR_GOOGLE_MAPS_API_KEY&q=<%= CGI.escape(@appointment.branch.address) %>"
          width="100%" 
          height="400"
          style="border:0;" 
          allowfullscreen="" 
          loading="lazy" 
          referrerpolicy="no-referrer-when-downgrade"
          class="w-full h-96 rounded-lg border border-gray-200">
        </iframe>
      </div>
      
      <div class="mt-4 flex items-center text-gray-600">
        <i class="fas fa-info-circle mr-2"></i>
        <p class="text-sm">
          地図が表示されない場合は、住所「<%= @appointment.branch.address %>」で検索してください
        </p>
      </div>
    <% end %>
  </div>

  <!-- 持参書類・注意事項 -->
  <div class="mt-8">
    <%= render 'shared/card',
        title: 'ご来店時のお願い',
        padding: 'lg',
        shadow: 'lg',
        bg_color: 'bg-blue-50' do %>
      
      <div class="space-y-6">
        <!-- 持参書類 -->
        <div>
          <h3 class="text-lg font-bold text-blue-800 mb-3">
            <i class="fas fa-file-alt text-blue-600 mr-2"></i>
            ご持参いただく書類
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-3">
              <div class="flex items-start">
                <i class="fas fa-check text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
                <div>
                  <p class="font-semibold text-gray-800">本人確認書類</p>
                  <p class="text-sm text-gray-600">運転免許証、パスポート、マイナンバーカードなど</p>
                </div>
              </div>
              <div class="flex items-start">
                <i class="fas fa-check text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
                <div>
                  <p class="font-semibold text-gray-800">印鑑</p>
                  <p class="text-sm text-gray-600">認印で結構です</p>
                </div>
              </div>
            </div>
            <div class="space-y-3">
              <div class="flex items-start">
                <i class="fas fa-check text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
                <div>
                  <p class="font-semibold text-gray-800">相続関連書類</p>
                  <p class="text-sm text-gray-600">遺言書、戸籍謄本、固定資産税納税通知書など（お持ちの範囲で）</p>
                </div>
              </div>
              <div class="flex items-start">
                <i class="fas fa-check text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
                <div>
                  <p class="font-semibold text-gray-800">通帳・証書類</p>
                  <p class="text-sm text-gray-600">預金通帳、保険証書など（お持ちの範囲で）</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 注意事項 -->
        <div>
          <h3 class="text-lg font-bold text-blue-800 mb-3">
            <i class="fas fa-exclamation-circle text-blue-600 mr-2"></i>
            ご来店時のお願い
          </h3>
          <div class="space-y-3 text-gray-700">
            <div class="flex items-start">
              <i class="fas fa-clock text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
              <p>ご予約時間の<strong>10分前</strong>までにお越しください。</p>
            </div>
            <div class="flex items-start">
              <i class="fas fa-phone text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
              <p>ご都合が悪くなった場合は、<strong>お早めに</strong>お電話でご連絡ください。</p>
            </div>
            <div class="flex items-start">
              <i class="fas fa-mask text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
              <p>体調がすぐれない場合は、ご無理をなさらずご相談ください。</p>
            </div>
            <div class="flex items-start">
              <i class="fas fa-parking text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
              <p>駐車場の台数に限りがございます。公共交通機関のご利用もご検討ください。</p>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- 確認メール送信通知 -->
  <% if @appointment.email.present? %>
    <div class="mt-8">
      <div class="bg-green-50 border border-green-200 rounded-lg p-6">
        <div class="flex items-center">
          <i class="fas fa-envelope text-green-600 mr-3"></i>
          <div>
            <p class="text-lg font-semibold text-green-800">確認メールを送信しました</p>
            <p class="text-sm text-gray-700 mt-1">
              <strong><%= @appointment.email %></strong> 宛に予約確認メールをお送りしました。<br>
              メールが届かない場合は、迷惑メールフォルダもご確認ください。
            </p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- ナビゲーションボタン -->
  <div class="mt-12 text-center space-y-4">
    <%= render 'shared/btn',
        text: 'ホームに戻る',
        variant: 'primary',
        size: 'xl',
        url: root_path,
        icon: 'fas fa-home' %>
    
    <div class="text-gray-600">
      <p class="text-lg">
        ご不明な点がございましたら、<br>
        <strong><%= @appointment.branch.name %></strong>（<%= @appointment.branch.phone.gsub(/(\d{4})(\d{2})(\d{4})/, '\1-\2-\3') if @appointment.branch.phone.length == 10 %><%= @appointment.branch.phone.gsub(/(\d{3})(\d{4})(\d{4})/, '\1-\2-\3') if @appointment.branch.phone.length == 11 %>）<br>
        までお気軽にお電話ください。
      </p>
    </div>
  </div>
</div>

<!-- Font Awesome CDN -->
<% content_for :head do %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<% end %>

<!-- 印刷用スタイル -->
<% content_for :head do %>
  <style>
    @media print {
      .no-print {
        display: none !important;
      }
      
      body {
        font-size: 12pt;
        color: black;
      }
      
      .bg-green-50, .bg-blue-50 {
        background-color: #f9f9f9 !important;
      }
    }
  </style>
<% end %>